  <project name="Jacoco Code Coverage" xmlns:jacoco="antlib:org.jacoco.ant">

    <property environment="env"/>
    
    <taskdef uri="antlib:org.jacoco.ant" resource="org/jacoco/ant/antlib.xml">
      <classpath path="${env.JACOCO_JAR_DIR}/jacocoant.jar"/>
    </taskdef>

    <target name="instr">
      <jacoco:instrument destdir="${env.WORKSPACE}/jars_instrumented">
        <fileset dir="${env.DIR_TO_INCLUDE}" includes="${env.JARS_TO_INCLUDE}" />
      </jacoco:instrument>
    </target>

    <target name="dump">
      <jacoco:dump address="${env.WAS_HOST_FQDN}" reset="true" destfile="${env.WORKSPACE}/remote.exec"/>
    </target>

    <target name="report">
      <jacoco:report>
        <executiondata>
          <fileset dir="${env.WORKSPACE}">
            <include name="**/*.exec"/>
          </fileset>
        </executiondata>

        <structure name="${env.APPLICATION_NAME}">
            <classfiles>
              <fileset dir="${env.WORKSPACE}/jars_original">
              </fileset>
            </classfiles>
        </structure>

        <xml destfile="${env.WORKSPACE}/jacoco_report.xml"/>

      </jacoco:report>
    </target>   
    
  </project>
